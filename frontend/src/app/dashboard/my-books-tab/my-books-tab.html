<div class="my-books-container">
  <div class="header">
    <h1>My Books</h1>
    <p class="subtitle">View your borrowed books and return history</p>
  </div>

  
  <div class="filter-tabs">
    <button class="filter-tab" 
            [class.active]="activeFilter === 'all'"
            (click)="setFilter('all')">
      All ({{ allBorrows.length }})
    </button>
    <button class="filter-tab" 
            [class.active]="activeFilter === 'borrowed'"
            (click)="setFilter('borrowed')">
      Borrowed ({{ getActiveCount() }})
    </button>
    <button class="filter-tab" 
            [class.active]="activeFilter === 'pending'"
            (click)="setFilter('pending')">
      Pending ({{ getPendingCount() }})
    </button>
    <button class="filter-tab" 
            [class.active]="activeFilter === 'overdue'"
            (click)="setFilter('overdue')">
      Overdue ({{ getOverdueCount() }})
    </button>
    <button class="filter-tab" 
            [class.active]="activeFilter === 'returned'"
            (click)="setFilter('returned')">
      Returned ({{ getReturnedCount() }})
    </button>
  </div>


  <div class="search-bar">
    <input type="text" 
           [(ngModel)]="searchTerm" 
           (input)="onSearch()"
           placeholder="Search by book title or author..." 
           class="search-input" />
  </div>

  @if (loading) {
    <div class="loading-message">
      <div class="spinner"></div>
      <p>Loading your books...</p>
    </div>
  }

  @if (errorMessage) {
    <div class="error-message">
      <p>{{ errorMessage }}</p>
      <button (click)="loadMyBooks()" class="retry-btn">Retry</button>
    </div>
  }

  @if (!loading && !errorMessage && filteredBorrows.length === 0) {
    <div class="no-books-message">
      <img src="assets/icons/books.png" alt="No books" class="empty-icon">
      <h3>No books found</h3>
      @if (searchTerm) {
        <p>Try adjusting your search or filters.</p>
      }
      @if (!searchTerm && activeFilter === 'all') {
        <p>You haven't borrowed any books yet.</p>
      }
      @if (!searchTerm && activeFilter !== 'all') {
        <p>No books match this filter.</p>
      }
    </div>
  }

  @if (!loading && !errorMessage && filteredBorrows.length > 0) {
    <div class="books-list">
      @for (borrow of filteredBorrows; track borrow.id) {
        <div class="borrow-card">
      <div class="book-image">
        <img [src]="borrow.bookCoverImage || 'assets/icons/books.png'" 
             [alt]="borrow.bookTitle"
             (error)="$any($event.target).src='assets/icons/books.png'">
      </div>

      <div class="borrow-info">
        <h3 class="book-title">{{ borrow.bookTitle }}</h3>
        <p class="book-author">by {{ borrow.bookAuthor }}</p>
        
        <div class="borrow-details">
          <div class="detail-item">
            <span class="label">Borrowed:</span>
            <span class="value">{{ formatDate(borrow.borrowDate) }}</span>
          </div>
          @if (borrow.dueDate) {
            <div class="detail-item">
              <span class="label">Due:</span>
              <span class="value" [class.overdue]="isOverdue(borrow)">
                {{ formatDate(borrow.dueDate) }}
              </span>
            </div>
          }
          @if (borrow.returnDate) {
            <div class="detail-item">
              <span class="label">Returned:</span>
              <span class="value">{{ formatDate(borrow.returnDate) }}</span>
            </div>
          }
        </div>

        <div class="borrow-status" [ngClass]="getStatusClass(borrow)">
          <span class="status-badge">{{ getStatusText(borrow) }}</span>
          @if (borrow.status === 'REJECTED' && borrow.rejectionReason) {
            <div class="rejection-inline" style="margin-top:0.3rem;">
              <span class="label">Rejection Reason:</span>
              <span class="value rejection-reason">{{ borrow.rejectionReason }}</span>
            </div>
          }
          @if (isOverdue(borrow)) {
            <span class="days-info overdue-text">
              {{ -getDaysUntilDue(borrow) }} days overdue
            </span>
          }
        </div>
      </div>
    </div>
      }
    </div>
  }
</div>
