<div class="manage-users-container">
  <div class="users-header">
    <div class="welcome-section">
      <h1>Manage Users</h1>
    </div>
    <button class="add-user-btn" (click)="openAddUserForm()">+ Add New User</button>
  </div>

  <div class="search-bar">
    <input 
      type="text" 
      [(ngModel)]="searchUserQuery" 
      (input)="searchUsers()" 
      placeholder="Search by name, email, or gender..."
      class="search-input"
    />
  </div>

  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Gender</th>
        </tr>
      </thead>
      <tbody>
        @for (userItem of filteredUsers; track userItem.id) {
          <tr>
            <td>{{ userItem.id }}</td>
            <td>{{ userItem.name }}</td>
            <td>{{ userItem.email }}</td>
            <td>{{ userItem.gender }}</td>
          </tr>
        } @empty {
          <tr>
            <td colspan="4" class="no-data">No users found</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- Add User Modal -->
<div class="modal" [class.show]="showAddUserForm">
  <div class="modal-overlay" (click)="closeAddUserForm()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add New User</h2>
      <button class="close-btn" (click)="closeAddUserForm()">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="addUser()">
        <div class="form-group">
          <label for="add-user-name">Name *</label>
          <input 
            type="text" 
            id="add-user-name" 
            [(ngModel)]="currentUser.name" 
            name="name"
            required
            minlength="3"
            pattern="^[A-Za-z ]+$"
            #addUserName="ngModel"
            [class.invalid]="addUserName.invalid && addUserName.touched"
            class="form-control"
          />
          @if (addUserName.invalid && addUserName.touched) {
            <div class="error-text">
              @if (addUserName.errors?.['required']) {
                <span>Name is required.</span>
              }
              @if (addUserName.errors?.['minlength']) {
                <span>Name must be at least 3 characters long.</span>
              }
              @if (addUserName.errors?.['pattern']) {
                <span>Name can only contain letters and spaces.</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="add-user-email">Email *</label>
          <input 
            type="email" 
            id="add-user-email" 
            [(ngModel)]="currentUser.email" 
            name="email"
            required
            email
            #addUserEmail="ngModel"
            [class.invalid]="addUserEmail.invalid && addUserEmail.touched"
            class="form-control"
          />
          @if (addUserEmail.invalid && addUserEmail.touched) {
            <div class="error-text">
              @if (addUserEmail.errors?.['required']) {
                <span>Email is required.</span>
              }
              @if (addUserEmail.errors?.['email']) {
                <span>Please enter a valid email address.</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="add-user-gender">Gender *</label>
          <select 
            id="add-user-gender" 
            [(ngModel)]="currentUser.gender" 
            name="gender"
            required
            #addUserGender="ngModel"
            [class.invalid]="addUserGender.invalid && addUserGender.touched"
            class="form-control"
          >
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
          @if (addUserGender.invalid && addUserGender.touched) {
            <div class="error-text">
              @if (addUserGender.errors?.['required']) {
                <span>Gender is required.</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="add-user-password">Password *</label>
          <input 
            type="password" 
            id="add-user-password" 
            [(ngModel)]="currentUser.password" 
            name="password"
            required
            minlength="6"
            pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]+$"
            #addUserPassword="ngModel"
            [class.invalid]="addUserPassword.invalid && addUserPassword.touched"
            placeholder="Enter password"
            class="form-control"
          />
          @if (addUserPassword.invalid && addUserPassword.touched) {
            <div class="error-text">
              @if (addUserPassword.errors?.['required']) {
                <span>Password is required.</span>
              }
              @if (addUserPassword.errors?.['minlength']) {
                <span>Password must be at least 6 characters long.</span>
              }
              @if (addUserPassword.errors?.['pattern']) {
                <span>Password must contain at least one letter and one number.</span>
              }
            </div>
          }
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeAddUserForm()">Cancel</button>
          <button type="submit" class="btn-submit">Add User</button>
        </div>
      </form>
    </div>
  </div>
</div>
